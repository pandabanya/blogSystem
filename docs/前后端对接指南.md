# 前后端对接指南

## 当前问题

1. ✅ 后端已有 2 篇文章数据
2. ❌ 前台博客展示为空
3. ❌ 开源项目和生活片段是硬编码数据

## 解决步骤

### 1. 启动后端服务

```bash
# 进入后端目录
cd packages/server

# 安装依赖（如果还没安装）
pnpm install

# 启动开发服务器
pnpm run start:dev
```

**验证后端启动成功：**
- 控制台输出：`🚀 Server is running on: http://localhost:3002`
- 访问：`http://localhost:3002/article` 应该能看到文章列表数据

### 2. 启动前台博客

```bash
# 新开一个终端，进入博客目录
cd packages/blog

# 安装依赖（如果还没安装）
pnpm install

# 启动开发服务器
pnpm run dev
```

**验证前台启动成功：**
- 控制台输出：`Local: http://localhost:3000/`
- 浏览器访问：`http://localhost:3000`

### 3. 检查数据对接

打开浏览器开发者工具（F12），切换到 Network 面板：

**正常情况：**
- 看到请求：`http://localhost:3002/article?page=1&pageSize=100`
- 状态码：200
- Response 有数据：`{ code: 200, message: 'success', data: { list: [...] } }`

**异常情况：**
- ❌ 请求失败（CORS 错误）→ 检查后端 CORS 配置
- ❌ 404 错误 → 检查后端路由是否正确
- ❌ 数据为空 → 检查数据库是否有已发布的文章（status: 'published'）

## 配置文件说明

### 后端配置

**端口：** 3002（`packages/server/src/main.ts` 第 26 行）

**数据库：** MongoDB Atlas  
连接字符串在 `packages/server/src/app.module.ts` 第 14 行

**CORS 允许的域名：**
```typescript
// packages/server/src/main.ts
origin: [
  'http://localhost:3000',  // blog 前台
  'http://localhost:3001',  // admin 后台
  // ... 生产环境域名
]
```

### 前端配置

**blog 前台：**
- 端口：3000（`packages/blog/vite.config.ts` 第 9 行）
- API 地址（开发环境）：`http://localhost:3002`（`.env.development`）
- API 地址（生产环境）：`https://blogsystem-c2hs.onrender.com`（`.env.production`）

**admin 后台：**
- 端口：默认 5173（Vite 默认）
- API 配置类似

## 数据流程图

```
用户访问 localhost:3000
  ↓
Home.vue 组件加载（onMounted）
  ↓
调用 fetchArticles()
  ↓
getArticles(1, 100)  →  axios.get('http://localhost:3002/article')
  ↓
后端 ArticleController.findAll()
  ↓
ArticleService.findAllArticle()
  ↓
MongoDB 查询 → 返回数据
  ↓
前端接收数据 → 页面渲染
```

## 常见问题排查

### 问题 1：页面显示空白

**检查：**
1. 浏览器控制台是否有错误？
2. Network 面板是否有 API 请求？
3. API 请求是否返回数据？

**解决：**
- 确保后端服务已启动
- 检查 `.env.development` 文件是否存在
- 清除浏览器缓存并刷新

### 问题 2：CORS 跨域错误

**错误信息：**
```
Access to XMLHttpRequest at 'http://localhost:3002/article' 
from origin 'http://localhost:3000' has been blocked by CORS policy
```

**解决：**
确保后端 `main.ts` 中的 CORS 配置包含前端地址

### 问题 3：数据库查询为空

**检查数据库：**
使用 MongoDB Compass 或 CLI 连接数据库，确认：
1. 数据库名称是否为 `blog`
2. 集合名称是否为 `articles`
3. 文档的 `status` 字段是否为 `'published'`

**修复：**
```bash
# 使用 admin 后台发布文章
# 或直接在数据库中修改 status 字段
```

## 下一步优化

- [ ] 将开源项目和生活片段数据动态化（存入数据库）
- [ ] 添加分类筛选功能
- [ ] 实现文章搜索
- [ ] 添加loading 加载状态
- [ ] 错误边界处理
